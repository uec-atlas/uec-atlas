---
import { type LinkedOntologyClass, ontologyClassMap } from "@/data/ontology";
import Heading2 from "@/components/Heading2.astro";

interface Props {
  item: LinkedOntologyClass;
}

const { item } = Astro.props;
---

<section class="mb-10">
  <Heading2>基本情報</Heading2>
  <div class="overflow-x-auto">
    <table class="d-table d-table-sm w-full">
      <tbody>
        <tr>
          <th
            class="w-1/4 text-slate-500 font-medium tracking-wider align-middle"
          >
            URI
          </th>
          <td class="align-middle">
            <code class="text-primary text-xs font-mono">
              {item.class_uri}
            </code>
          </td>
        </tr>
        {
          item.is_a && (
            <tr>
              <th class="text-slate-500 font-medium tracking-wider align-middle">
                親クラス
              </th>
              <td class="flex flex-wrap gap-1 align-middle">
                <a
                  href={`/docs/ontology/${item.is_a.id}`}
                  class="text-xs px-2 py-0.5 bg-slate-100 rounded no-underline hover:bg-slate-200 transition-colors"
                >
                  {item.is_a.id}
                </a>
              </td>
            </tr>
          )
        }
        {
          item.children && item.children.length > 0 && (
            <tr>
              <th class="text-slate-500 font-medium tracking-wider align-middle">
                子クラス
              </th>
              <td class="flex flex-wrap gap-1 align-middle">
                {item.children.map((child) => (
                  <a
                    href={`/docs/ontology/${child.id}`}
                    class="text-xs px-2 py-0.5 bg-slate-100 rounded no-underline hover:bg-slate-200 transition-colors"
                  >
                    {child.id}
                  </a>
                ))}
              </td>
            </tr>
          )
        }
      </tbody>
    </table>
  </div>
</section>

<section class="mb-10">
  <Heading2>プロパティ</Heading2>
  <div class="overflow-x-auto">
    <table class="d-table d-table-sm w-full border border-base-200">
      <thead>
        <tr class="bg-base-200/50">
          <th class="text-slate-500 font-bold tracking-wider"> 名前 / URI </th>
          <th class="text-slate-500 font-bold tracking-wider"> 型 / 制約 </th>
          <th class="text-slate-500 font-bold tracking-wider"> 説明 </th>
          <th class="text-slate-500 font-bold tracking-wider"> 継承元 </th>
        </tr>
      </thead>
      <tbody>
        {
          item.slots
            .sort((a, b) => {
              if (a.required !== b.required) return a.required ? -1 : 1;
              const aInherited = !!a.inherited_from;
              const bInherited = !!b.inherited_from;
              if (aInherited !== bInherited) return aInherited ? 1 : -1;
              return a.name.localeCompare(b.name);
            })
            .map((slot) => (
              <tr>
                <td class="align-middle">
                  <div class="font-bold">
                    <a
                      href={`/docs/ontology/${slot.name}`}
                      class="d-link d-link-primary d-link-hover"
                    >
                      {slot.name}
                    </a>
                    {slot.required && (
                      <span class="text-error" title="必須">
                        *
                      </span>
                    )}
                  </div>
                  <code class="text-[10px] text-slate-400 font-mono block mt-0.5">
                    {slot.slot_uri}
                  </code>
                </td>
                <td class="align-middle">
                  <div class="mb-1">
                    {slot.range === "I18NString" ? (
                      <span class="text-xs font-mono font-bold text-slate-600">
                        string
                      </span>
                    ) : slot.name === "type" ? (
                      <span class="text-xs font-mono font-bold text-slate-600">
                        string
                      </span>
                    ) : slot.range === "Any" ? (
                      <span class="text-xs font-mono text-slate-300"> - </span>
                    ) : ontologyClassMap.has(slot.range) ? (
                      <a
                        href={`/docs/ontology/${slot.range}`}
                        class="d-link d-link-primary d-link-hover text-xs font-mono font-bold"
                      >
                        {slot.range}
                      </a>
                    ) : (
                      <span class="text-xs font-mono font-bold text-slate-600">
                        {slot.range}
                      </span>
                    )}
                  </div>
                  <div class="flex flex-wrap gap-1">
                    {slot.range !== "I18NString" && (
                      <>
                        {slot.multivalued && (
                          <span class="d-badge d-badge-info d-badge-outline d-badge-xs font-bold leading-none">
                            {slot.inlined_as_list ? "List (Inline)" : "List"}
                          </span>
                        )}
                        {slot.inlined && !slot.inlined_as_list && (
                          <span class="d-badge d-badge-primary d-badge-outline d-badge-xs font-bold leading-none">
                            Object (Inline)
                          </span>
                        )}
                      </>
                    )}
                  </div>
                </td>
                <td class="text-xs text-slate-600 max-w-xs align-middle">
                  {slot.description}
                </td>
                <td class="text-xs text-slate-400 align-middle">
                  {slot.inherited_from && (
                    <a
                      href={`/docs/ontology/${slot.inherited_from}`}
                      class="d-link d-link-primary d-link-hover"
                    >
                      {slot.inherited_from}
                    </a>
                  )}
                </td>
              </tr>
            ))
        }
      </tbody>
    </table>
  </div>
</section>
